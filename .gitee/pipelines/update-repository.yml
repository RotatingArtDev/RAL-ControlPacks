name: update-repository
displayName: æ›´æ–°ä»“åº“ç´¢å¼•

triggers:
  push:
    branches:
      include:
        - main
    paths:
      include:
        - packs/**

stages:
  - name: update
    displayName: æ›´æ–° repository.json
    jobs:
      - name: generate
        displayName: ç”Ÿæˆç´¢å¼•
        runs-on: ubuntu-latest
        steps:
          - name: checkout
            step: checkout@1
            
          - name: setup-python
            step: setup-python@1
            with:
              python-version: '3.11'
              
          - name: generate
            step: shell@1
            with:
              script: |
                python generate_repository.py
                
          - name: commit
            step: shell@1
            with:
              script: |
                git config --local user.email "gitee-ci@gitee.com"
                git config --local user.name "Gitee CI"
                git add repository.json
                git diff --staged --quiet || git commit -m "ğŸ”„ è‡ªåŠ¨æ›´æ–° repository.json"
                git push

